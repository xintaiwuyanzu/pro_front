<script>
import icons from 'vue-icon/lib/feather-icons.esm'

export default {
  name: 'icon',
  props: {
    icon: String,
    default: {type: String, default: 'setting'}
  },
  render(h) {
    let iconValue = this.icon
    if (!iconValue) {
      iconValue = this.default
    }
    if (iconValue.startsWith('el-icon')) {
      return h('i', {class: iconValue})
    } else {
      const elms = [];
      const icon = icons[iconValue];
      const shapeNameMap = {
        p: 'path',
        r: 'rect',
        c: 'circle',
        e: 'ellipse',
        l: 'line',
        g: 'polygon',
        b: 'polyline'
      };
      if (icon) {
        let i = 0;
        const j = icon.length;
        for (; i < j; i += 2) {
          let attrs = {};
          const shortName = icon[i];
          let attrVal = icon[i + 1];
          if (['r', 'c', 'e', 'l'].indexOf(shortName) > -1) {
            attrVal = attrVal.split(' ')
          }
          switch (shortName) {
            case 'p':
              attrs.d = attrVal
              break
            case 'r':
              attrs = {
                x: attrVal[0],
                y: attrVal[1],
                width: attrVal[2],
                height: attrVal[3]
              }
              if (attrVal[4] !== undefined) {
                attrs.rx = attrVal[4]
                attrs.ry = attrVal[5]
              }
              break
            case 'c':
              attrs = {
                cx: attrVal[0],
                cy: attrVal[1],
                r: attrVal[2]
              }
              break
            case 'e':
              attrs = {
                cx: attrVal[0],
                cy: attrVal[1],
                rx: attrVal[2],
                ry: attrVal[3]
              }
              break
            case 'l':
              attrs = {
                x1: attrVal[0],
                x2: attrVal[1],
                y1: attrVal[2],
                y2: attrVal[3]
              }
              break
            case 'g':
            case 'b':
              attrs.points = attrVal
              break
          }

          elms.push(h(shapeNameMap[icon[i]], {
            attrs: attrs
          }))
        }
      }
      return h('svg', {
        class: ['svg-icon-' + iconValue, 'el-icon-svg'],
        attrs: {
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          'stroke-width': '2',
          'stroke-linecap': 'round',
          'stroke-linejoin': 'round'
        }
      }, elms)
    }
  }
}
</script>
